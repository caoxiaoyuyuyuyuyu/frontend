{"version":3,"file":"api.js","sources":["pages/chatAI/api.js"],"sourcesContent":["/**\n * AI聊天API接口\n * 包含AI对话、历史记录管理、后端API连接等功能\n */\n\nimport { getApiUrl, getHeaders, request, uploadFile } from '../../utils/apiConfig.js';\n\n/**\n * 发送AI对话消息\n * @param {Object} messageData - 消息数据\n * @param {String} messageData.content - 消息内容\n * @param {String} messageData.type - 消息类型 (user/ai)\n * @param {String} messageData.time - 消息时间\n * @param {Boolean} messageData.hasQuote - 是否包含引用\n * @returns {Promise} 返回AI回复\n */\nexport const sendAIMessage = (data) =>\n  request({ url: '/chat/send', method: 'POST', data });\n\n/**\n * 保存对话到后端\n * @param {Object} chatData - 对话数据\n * @param {String} chatData.id - 对话ID\n * @param {String} chatData.title - 对话标题\n * @param {String} chatData.lastTime - 最后更新时间\n * @param {Array} chatData.messages - 消息列表\n * @returns {Promise} 保存结果\n */\nexport const saveChatToBackend = (chat) =>\n  request({ url: '/chat/save', method: 'POST', data: chat });\n\n/**\n * 从后端加载历史对话列表\n * @param {Object} params - 请求参数\n * @returns {Promise} 返回历史对话列表\n */\nexport const loadHistoryChats = (params = {}) =>\n  request({ url: '/chat/history', method: 'GET', data: params });\n\n/**\n * 获取指定对话详情\n * @param {String} chatId - 对话ID\n * @returns {Promise} 返回对话详情\n */\nexport const getChatDetail = (chatId) => {\n  return request({\n    url: `/chat/${chatId}`,\n    method: 'GET'\n  });\n};\n\n/**\n * 删除对话\n * @param {String} chatId - 对话ID\n * @returns {Promise} 返回删除结果\n */\nexport const deleteChat = (chatId) =>\n  request({ url: `/chat/${chatId}`, method: 'DELETE' });\n\n/**\n * 搜索对话内容\n * @param {String} keyword - 搜索关键词\n * @param {String} filterType - 筛选类型 (all/today/week/month)\n * @returns {Promise} 返回搜索结果\n */\nexport const searchChats = (keyword, filterType = 'all') =>\n  request({ url: '/chat/search', method: 'GET', data: { keyword, filterType } });\n\n/**\n * 设置选中的对话（临时存储）\n * @param {Object} chat - 对话数据\n */\nexport const setSelectedChat = (chat) => {\n  try { uni.setStorageSync('selectedChat', chat); } catch (e) { console.error('设置选中对话失败', e); }\n};\n\n/**\n * 获取选中的对话\n * @returns {Object|null} 选中的对话\n */\nexport const getSelectedChat = () => {\n  try {\n    const chat = uni.getStorageSync('selectedChat');\n    if (chat) uni.removeStorageSync('selectedChat');\n    return chat || null;\n  } catch (e) { console.error('获取选中对话失败', e); return null; }\n};\n\n/**\n * 复制消息到剪贴板\n * @param {String} content - 消息内容\n * @returns {Promise} 复制结果\n */\nexport const copyMessage = (content) =>\n  new Promise((resolve, reject) => {\n    uni.setClipboardData({\n      data: content,\n      success: () => resolve({ success: true }),\n      fail: () => reject(new Error('复制失败'))\n    });\n  });\n\n/**\n * 提交反馈\n * @param {Object} feedbackData - 反馈数据\n * @param {String} feedbackData.type - 反馈类型\n * @param {String} feedbackData.message - 反馈消息\n * @param {String} feedbackData.chatId - 对话ID\n * @returns {Promise} 提交结果\n */\nexport const submitFeedback = (feedback) =>\n  request({ url: '/chat/feedback', method: 'POST', data: feedback });\n\n/**\n * 获取当前时间\n * @returns {String} 当前时间字符串 (HH:MM)\n */\nexport const getCurrentTime = () => {\n  const now = new Date();\n  return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;\n};\n\n/**\n * 获取当前日期时间\n * @returns {String} 当前日期时间字符串 (YYYY-MM-DD HH:MM)\n */\nexport const getCurrentDateTime = () => {\n  const now = new Date();\n  return `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,'0')}-${now.getDate().toString().padStart(2,'0')} ${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}`;\n};\n\n/**\n * 生成对话ID\n * @returns {String} 对话ID\n */\nexport const generateChatId = () => 'chat' + Date.now();\n\n/**\n * 获取对话标题\n * @param {Array} messages - 消息列表\n * @returns {String} 对话标题\n */\nexport const getChatTitle = (messages) => {\n  const userMsg = messages.find(msg => msg.type === 'user');\n  if (userMsg) return userMsg.content.length > 20 ? userMsg.content.slice(0, 20) + '...' : userMsg.content;\n  return '新对话';\n};\n\n/**\n * 获取消息预览文本\n * @param {Array} messages - 消息列表\n * @returns {String} 预览文本\n */\nexport const getMessagePreview = (messages) => {\n  if (!messages.length) return '';\n  const text = messages[messages.length - 1].content;\n  return text.length > 30 ? text.slice(0, 30) + '...' : text;\n};\n\n/**\n * 图片识别API\n * @param {String} imagePath - 图片路径\n * @param {Object} params - 请求参数\n * @returns {Promise} 返回识别结果\n */\nexport const identifyImage = (imagePath, params = {}) => {\n  return uploadFile({\n    url: '/chat/identify',\n    filePath: imagePath,\n    formData: params\n  });\n};\n\n/**\n * 用户登录\n * @param {Object} loginData - 登录数据\n * @returns {Promise} 返回登录结果\n */\nexport const userLogin = (loginData) => {\n  return request({\n    url: '/auth/login',\n    method: 'POST',\n    data: loginData,\n    headers: { 'Content-Type': 'application/json' }\n  });\n};\n\n/**\n * 获取用户信息\n * @returns {Promise} 返回用户信息\n */\nexport const getUserInfo = () => {\n  return request({\n    url: '/user/info',\n    method: 'GET'\n  });\n};\n\n/**\n * 更新用户信息\n * @param {Object} userData - 用户数据\n * @returns {Promise} 返回更新结果\n */\nexport const updateUserInfo = (userData) => {\n  return request({\n    url: '/user/info',\n    method: 'PUT',\n    data: userData\n  });\n};\n\nexport default {\n  sendAIMessage,\n  saveChatToBackend,\n  loadHistoryChats,\n  getChatDetail,\n  deleteChat,\n  searchChats,\n  setSelectedChat,\n  getSelectedChat,\n  copyMessage,\n  submitFeedback,\n  getCurrentTime,\n  getCurrentDateTime,\n  generateChatId,\n  getChatTitle,\n  getMessagePreview,\n  identifyImage,\n  userLogin,\n  getUserInfo,\n  updateUserInfo\n}; "],"names":["request","uni"],"mappings":";;;AAgBY,MAAC,gBAAgB,CAAC,SAC5BA,gBAAO,QAAC,EAAE,KAAK,cAAc,QAAQ,QAAQ,MAAM;AAWzC,MAAC,oBAAoB,CAAC,SAChCA,gBAAO,QAAC,EAAE,KAAK,cAAc,QAAQ,QAAQ,MAAM,MAAM;AAO/C,MAAC,mBAAmB,CAAC,SAAS,CAAE,MAC1CA,gBAAO,QAAC,EAAE,KAAK,iBAAiB,QAAQ,OAAO,MAAM,QAAQ;AAmBnD,MAAC,aAAa,CAAC,WACzBA,wBAAQ,EAAE,KAAK,SAAS,MAAM,IAAI,QAAQ,UAAU;AAQ1C,MAAC,cAAc,CAAC,SAAS,aAAa,UAChDA,wBAAQ,EAAE,KAAK,gBAAgB,QAAQ,OAAO,MAAM,EAAE,SAAS,WAAU,GAAI;AAMnE,MAAC,kBAAkB,CAAC,SAAS;AACvC,MAAI;AAAEC,kBAAG,MAAC,eAAe,gBAAgB,IAAI;AAAA,EAAE,SAAU,GAAG;AAAEA,oEAAc,YAAY,CAAC;AAAA,EAAI;AAC/F;AAMY,MAAC,kBAAkB,MAAM;AACnC,MAAI;AACF,UAAM,OAAOA,cAAAA,MAAI,eAAe,cAAc;AAC9C,QAAI;AAAMA,oBAAAA,MAAI,kBAAkB,cAAc;AAC9C,WAAO,QAAQ;AAAA,EAChB,SAAQ,GAAG;AAAEA,kBAAA,MAAA,MAAA,SAAA,6BAAc,YAAY,CAAC;AAAG,WAAO;AAAA,EAAO;AAC5D;AAOY,MAAC,cAAc,CAAC,YAC1B,IAAI,QAAQ,CAAC,SAAS,WAAW;AAC/BA,gBAAAA,MAAI,iBAAiB;AAAA,IACnB,MAAM;AAAA,IACN,SAAS,MAAM,QAAQ,EAAE,SAAS,KAAI,CAAE;AAAA,IACxC,MAAM,MAAM,OAAO,IAAI,MAAM,MAAM,CAAC;AAAA,EAC1C,CAAK;AACL,CAAG;AAUS,MAAC,iBAAiB,CAAC,aAC7BD,gBAAO,QAAC,EAAE,KAAK,kBAAkB,QAAQ,QAAQ,MAAM,UAAU;AAMvD,MAAC,iBAAiB,MAAM;AAClC,QAAM,MAAM,oBAAI;AAChB,SAAO,GAAG,IAAI,SAAU,EAAC,SAAQ,EAAG,SAAS,GAAG,GAAG,CAAC,IAAI,IAAI,WAAY,EAAC,SAAU,EAAC,SAAS,GAAG,GAAG,CAAC;AACtG;AAMY,MAAC,qBAAqB,MAAM;AACtC,QAAM,MAAM,oBAAI;AAChB,SAAO,GAAG,IAAI,YAAa,CAAA,KAAK,IAAI,SAAU,IAAC,GAAG,SAAU,EAAC,SAAS,GAAE,GAAG,CAAC,IAAI,IAAI,QAAO,EAAG,SAAQ,EAAG,SAAS,GAAE,GAAG,CAAC,IAAI,IAAI,SAAU,EAAC,SAAU,EAAC,SAAS,GAAE,GAAG,CAAC,IAAI,IAAI,WAAU,EAAG,SAAQ,EAAG,SAAS,GAAE,GAAG,CAAC;AACtN;AAMY,MAAC,iBAAiB,MAAM,SAAS,KAAK,IAAM;AAO5C,MAAC,eAAe,CAAC,aAAa;AACxC,QAAM,UAAU,SAAS,KAAK,SAAO,IAAI,SAAS,MAAM;AACxD,MAAI;AAAS,WAAO,QAAQ,QAAQ,SAAS,KAAK,QAAQ,QAAQ,MAAM,GAAG,EAAE,IAAI,QAAQ,QAAQ;AACjG,SAAO;AACT;AAOY,MAAC,oBAAoB,CAAC,aAAa;AAC7C,MAAI,CAAC,SAAS;AAAQ,WAAO;AAC7B,QAAM,OAAO,SAAS,SAAS,SAAS,CAAC,EAAE;AAC3C,SAAO,KAAK,SAAS,KAAK,KAAK,MAAM,GAAG,EAAE,IAAI,QAAQ;AACxD;;;;;;;;;;;;;;;"}