{"version":3,"file":"record.js","sources":["pages/profile/record.vue","../../HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvcHJvZmlsZS9yZWNvcmQudnVl"],"sourcesContent":["<template>\r\n  <view class=\"record-container\">\r\n    <!-- 搜索和筛选 -->\r\n    <view class=\"search-filter\">\r\n      <input class=\"search-input\" v-model=\"searchText\" placeholder=\"搜索害虫名称\" @input=\"filterRecords\" />\r\n      <picker :range=\"timeOptions\" :value=\"timeFilter\" @change=\"onTimeChange\">\r\n        <view class=\"filter-btn\">{{ timeOptions[timeFilter] }}</view>\r\n      </picker>\r\n      <picker :range=\"confidenceOptions\" :value=\"confidenceFilter\" @change=\"onConfidenceChange\">\r\n        <view class=\"filter-btn\">{{ confidenceOptions[confidenceFilter] }}</view>\r\n      </picker>\r\n    </view>\r\n\r\n    <!-- 数据统计 -->\r\n    <view class=\"stat-section\">\r\n      <text>本月识别：{{ stat.count }} 次，常见类型：{{ stat.topType }}</text>\r\n    </view>\r\n\r\n    <!-- 识别记录列表 -->\r\n    <view v-if=\"filteredRecords.length === 0\" class=\"empty-tip\">暂无识别记录</view>\r\n    <view v-for=\"item in filteredRecords\" :key=\"item.id\" class=\"record-row\">\r\n      <image :src=\"item.image\" class=\"record-img\" />\r\n      <view class=\"record-info\">\r\n        <view class=\"record-title\">{{ item.name }}</view>\r\n        <view class=\"record-meta\">\r\n          <text>{{ item.time }}</text>\r\n          <text class=\"confidence\">{{ item.confidence }}匹配</text>\r\n        </view>\r\n        <view class=\"record-actions\">\r\n          <button @click=\"viewDetail(item)\">详情</button>\r\n          <button @click=\"deleteRecord(item)\">删除</button>\r\n        </view>\r\n      </view>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      records: [\r\n        // 示例数据，实际应从后端获取\r\n        {\r\n          id: 1,\r\n          image: '/static/pest1.jpg',\r\n          name: '棉铃虫',\r\n          time: '2024/07/15 14:30:00',\r\n          confidence: '92%',\r\n          type: '蛾类'\r\n        },\r\n        // ...\r\n      ],\r\n      searchText: '',\r\n      timeOptions: ['全部', '最近一周', '最近一个月'],\r\n      timeFilter: 0,\r\n      confidenceOptions: ['默认排序', '高可信度优先', '低可信度优先'],\r\n      confidenceFilter: 0,\r\n      filteredRecords: [],\r\n      stat: {\r\n        count: 0,\r\n        topType: ''\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    this.filterRecords()\r\n    this.calcStat()\r\n  },\r\n  methods: {\r\n    fixDateStr(str) {\r\n      // \"2024-07-15 14:30\" => \"2024/07/15 14:30:00\"\r\n      if (!str) return ''\r\n      return str.replace(/-/g, '/').replace(/(\\d{2}:\\d{2})$/, '$1:00')\r\n    },\r\n    filterRecords() {\r\n      // 搜索和筛选逻辑\r\n      let list = this.records\r\n      if (this.searchText) {\r\n        list = list.filter(r => r.name.includes(this.searchText))\r\n      }\r\n      // 时间筛选\r\n      if (this.timeFilter === 1) {\r\n        // 最近一周\r\n        const weekAgo = Date.now() - 7 * 24 * 60 * 60 * 1000\r\n        list = list.filter(r => new Date(this.fixDateStr(r.time)).getTime() > weekAgo)\r\n      } else if (this.timeFilter === 2) {\r\n        // 最近一个月\r\n        const monthAgo = Date.now() - 30 * 24 * 60 * 60 * 1000\r\n        list = list.filter(r => new Date(this.fixDateStr(r.time)).getTime() > monthAgo)\r\n      }\r\n      // 可信度排序\r\n      if (this.confidenceFilter === 1) {\r\n        list = list.slice().sort((a, b) => parseInt(b.confidence) - parseInt(a.confidence))\r\n      } else if (this.confidenceFilter === 2) {\r\n        list = list.slice().sort((a, b) => parseInt(a.confidence) - parseInt(b.confidence))\r\n      }\r\n      this.filteredRecords = list\r\n    },\r\n    onTimeChange(e) {\r\n      this.timeFilter = e.detail.value\r\n      this.filterRecords()\r\n    },\r\n    onConfidenceChange(e) {\r\n      this.confidenceFilter = e.detail.value\r\n      this.filterRecords()\r\n    },\r\n    viewDetail(item) {\r\n      uni.navigateTo({ url: `/pages/profile/recordDetail?id=${item.id}` })\r\n    },\r\n    deleteRecord(item) {\r\n      uni.showModal({\r\n        title: '确认删除',\r\n        content: '确定要删除该识别记录吗？',\r\n        success: (res) => {\r\n          if (res.confirm) {\r\n            this.records = this.records.filter(r => r.id !== item.id)\r\n            this.filterRecords()\r\n            this.calcStat()\r\n          }\r\n        }\r\n      })\r\n    },\r\n    calcStat() {\r\n      // 统计本月识别次数和常见类型\r\n      const now = new Date()\r\n      const month = now.getMonth() + 1\r\n      const monthRecords = this.records.filter(r => new Date(this.fixDateStr(r.time)).getMonth() + 1 === month)\r\n      this.stat.count = monthRecords.length\r\n      // 统计最多的type\r\n      const typeCount = {}\r\n      monthRecords.forEach(r => {\r\n        typeCount[r.type] = (typeCount[r.type] || 0) + 1\r\n      })\r\n      let topType = ''\r\n      let max = 0\r\n      for (const k in typeCount) {\r\n        if (typeCount[k] > max) {\r\n          max = typeCount[k]\r\n          topType = k\r\n        }\r\n      }\r\n      this.stat.topType = topType ? `${Math.round((max / (monthRecords.length || 1)) * 100)}%是${topType}` : '无'\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.record-container {\r\n  padding: 32rpx 24rpx 32rpx 24rpx;\r\n  background: #f8f9fb;\r\n  min-height: 100vh;\r\n}\r\n.search-filter {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 18rpx;\r\n}\r\n.search-input {\r\n  flex: 1;\r\n  font-size: 26rpx;\r\n  border: 1rpx solid #eee;\r\n  border-radius: 8rpx;\r\n  padding: 8rpx 12rpx;\r\n  background: #fafafa;\r\n  margin-right: 12rpx;\r\n}\r\n.filter-btn {\r\n  font-size: 24rpx;\r\n  color: #2d2e3a;\r\n  background: #eee;\r\n  border-radius: 8rpx;\r\n  padding: 8rpx 16rpx;\r\n  margin-right: 8rpx;\r\n}\r\n.stat-section {\r\n  font-size: 24rpx;\r\n  color: #888;\r\n  margin-bottom: 18rpx;\r\n}\r\n.empty-tip {\r\n  color: #bbb;\r\n  font-size: 24rpx;\r\n  text-align: center;\r\n  margin: 32rpx 0;\r\n}\r\n.record-row {\r\n  display: flex;\r\n  align-items: center;\r\n  border-bottom: 1rpx solid #f0f0f0;\r\n  padding: 18rpx 0;\r\n}\r\n.record-img {\r\n  width: 100rpx;\r\n  height: 100rpx;\r\n  border-radius: 12rpx;\r\n  margin-right: 18rpx;\r\n  object-fit: cover;\r\n}\r\n.record-info {\r\n  flex: 1;\r\n}\r\n.record-title {\r\n  font-size: 28rpx;\r\n  color: #222;\r\n  font-weight: bold;\r\n}\r\n.record-meta {\r\n  font-size: 24rpx;\r\n  color: #888;\r\n  margin: 4rpx 0;\r\n  display: flex;\r\n  justify-content: space-between;\r\n}\r\n.confidence {\r\n  color: #4caf50;\r\n}\r\n.record-actions {\r\n  display: flex;\r\n  gap: 12rpx;\r\n  margin-top: 8rpx;\r\n}\r\n.record-actions button {\r\n  font-size: 22rpx;\r\n  padding: 4rpx 16rpx;\r\n  border-radius: 8rpx;\r\n  background: #e5d3b6;\r\n  color: #7d5c1e;\r\n  border: none;\r\n}\r\n</style>","import MiniProgramPage from 'D:/Projects/frontend/pages/profile/record.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":"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"}