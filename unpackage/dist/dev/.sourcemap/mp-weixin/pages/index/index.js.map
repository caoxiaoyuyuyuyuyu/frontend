{"version":3,"file":"index.js","sources":["pages/index/index.vue","../../HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvaW5kZXgvaW5kZXgudnVl"],"sourcesContent":["<template>\n    <view class=\"container\">\n        <!-- 登录弹窗组件 -->\n        <login v-if=\"showLoginPopup\" :show=\"showLoginPopup\" @success=\"onLoginSuccess\" />\n        \n        <!-- 识别结果弹窗 -->\n        <view class=\"result-popup\" v-if=\"showResultPopup\">\n            <view class=\"popup-mask\" @click=\"closeResultPopup\"></view>\n            <view class=\"popup-content\">\n                <view class=\"popup-header\">\n                    <text class=\"popup-title\">识别结果</text>\n                    <text class=\"close-btn\" @click=\"closeResultPopup\">×</text>\n                </view>\n                \n                <view class=\"result-summary\">\n                    <text class=\"summary-text\">共识别到 {{ detectionResults.length }} 种害虫</text>\n                </view>\n                \n                <scroll-view class=\"result-list\" scroll-y>\n                    <view class=\"result-item\" v-for=\"(item, index) in detectionResults\" :key=\"index\" @click=\"goToPestDetail(item.pest_id)\">\n                        <image class=\"result-image\" :src=\"getImageUrl(item.image_url)\" mode=\"aspectFill\"></image>\n                        <view class=\"result-info\">\n                            <text class=\"pest-name\">{{ item.pest_name }}</text>\n                            <text class=\"confidence\">可信度: {{ (item.confidence * 100).toFixed(1) }}%</text>\n                        </view>\n                        <view class=\"result-arrow\">›</view>\n                    </view>\n                </scroll-view>\n                \n                <!-- <view class=\"popup-footer\">\n                    <button class=\"record-btn\" @click=\"goToRecordPage\">查看识别记录</button>\n                </view> -->\n            </view>\n        </view>\n        \n        <!-- 顶部标题区域 -->\n        <view class=\"header\">\n            <view class=\"title-container\">\n                <text class=\"main-title\">智慧农业</text>\n                <text class=\"sub-title\">AI智能害虫识别系统</text>\n            </view>\n            <view class=\"decoration\">\n                <view class=\"leaf leaf-1\"></view>\n                <view class=\"leaf leaf-2\"></view>\n                <view class=\"leaf leaf-3\"></view>\n            </view>\n        </view>\n        \n        <!-- 中间按钮区域 -->\n        <view class=\"button-container\">\n            <view class=\"button-group\">\n                <!-- 相机拍照按钮 -->\n                <view class=\"action-button camera-button\" @click=\"takePhoto\">\n                    <view class=\"button-icon\">\n                        <image src=\"/static/camera.png\" class=\"icon-image\"></image>\n                    </view>\n                    <view class=\"button-content\">\n                        <text class=\"button-text\">拍照识别</text>\n                        <text class=\"button-desc\">实时拍摄害虫照片进行识别</text>\n                    </view>\n                    <view class=\"button-arrow\">›</view>\n                </view>\n                \n                <!-- 照片选择按钮 -->\n                <view class=\"action-button gallery-button\" @click=\"chooseImage\">\n                    <view class=\"button-icon\">\n                        <image src=\"/static/picture.png\" class=\"icon-image\"></image>\n                    </view>\n                    <view class=\"button-content\">\n                        <text class=\"button-text\">相册选择</text>\n                        <text class=\"button-desc\">从相册选择照片进行识别</text>\n                    </view>\n                    <view class=\"button-arrow\">›</view>\n                </view>\n            </view>\n        </view>\n        \n        <!-- 底部说明区域 -->\n        <view class=\"footer\">\n            <view class=\"footer-content\">\n                <text class=\"footer-text\">支持识别常见农作物害虫</text>\n                <text class=\"footer-sub-text\">让AI为您的农业生产保驾护航</text>\n            </view>\n        </view>\n    </view>\n</template>\n\n<script>\n    import login from '../../components/login/login.vue'\n    import { identifyImage } from './api.js'\r\n\timport { getApiUrl } from '../../utils/apiConfig.js';\n    \n    export default {\n        components: { login },\n        data() {\n            return {\n                title: '智慧农业',\n                showLoginPopup: false,\n                hasLogin: false,\n                userInfo: {},\n                showResultPopup: false,\n                detectionResults: []\n            }\n        },\n        onShow() {\n            this.checkLogin();\n        },\n        methods: {\n            // 检查登录状态\n            checkLogin() {\n                const token = uni.getStorageSync('token')\n                if (token) {\n                    this.hasLogin = true\n                    this.userInfo = uni.getStorageSync('userInfo') || {}\n                    this.showLoginPopup = false\n                } else {\n                    this.hasLogin = false\n                    this.showLoginPopup = true\n                }\n            },\n            // 登录弹窗回调\n            onLoginSuccess(userInfo) {\n                this.hasLogin = true\n                this.userInfo = userInfo\n                this.showLoginPopup = false\n            },\n            // 拍照功能\n            takePhoto() {\n                uni.chooseImage({\n                    count: 1,\n                    sourceType: ['camera'],\n                    success: (res) => {\n                        console.log('拍照成功:', res.tempFilePaths);\n                        this.uploadAndIdentify(res.tempFilePaths[0]);\n                    },\n                    fail: (err) => {\n                        console.error('拍照失败:', err);\n                        uni.showToast({\n                            title: '拍照失败',\n                            icon: 'none'\n                        });\n                    }\n                });\n            },\n            \n            // 选择照片功能\n            chooseImage() {\n                uni.chooseImage({\n                    count: 1,\n                    sourceType: ['album'],\n                    success: (res) => {\n                        console.log('选择照片成功:', res.tempFilePaths);\n                        this.uploadAndIdentify(res.tempFilePaths[0]);\n                    },\n                    fail: (err) => {\n                        console.error('选择照片失败:', err);\n                        uni.showToast({\n                            title: '选择照片失败',\n                            icon: 'none'\n                        });\n                    }\n                });\n            },\n            \n            // 上传并识别\n            async uploadAndIdentify(imagePath) {\n                uni.showLoading({\n                    title: '正在识别...',\n                    mask: true\n                });\n                \n                try {\n                    const response = await identifyImage(imagePath);\n                    console.log('识别结果:', response);\n                    \n                    if (response.code === 200) {\n                        this.detectionResults = response.data;\n                        this.showResultPopup = true;\n                    } else {\n                        uni.showToast({\n                            title: response.message || '识别失败',\n                            icon: 'none'\n                        });\n                    }\n                } catch (error) {\n                    console.error('识别出错:', error);\n                    uni.showToast({\n                        title: '识别服务异常',\n                        icon: 'none'\n                    });\n                } finally {\n                    uni.hideLoading();\n                }\n            },\n            \n            // 获取图片完整URL\n            getImageUrl(imagePath) {\r\n\t\t\t  if (!imagePath) return '';\r\n\t\t\t  return getApiUrl(`/detect/images/${imagePath}`);\n            },\n            \n            // 关闭结果弹窗\n            closeResultPopup() {\n                this.showResultPopup = false;\n            },\n            \n            // 跳转到害虫详情页\n            goToPestDetail(pestId) {\n                uni.navigateTo({\n                    url: `/pages/pestDetail/pestDetail?pestId=${pestId}`\n                });\n            },\n            \n            // 跳转到识别记录页\n            goToRecordPage() {\n                uni.navigateTo({\n                    url: '/pages/profile/record'\n                });\n            }\n        }\n    }\n</script>\r\n\r\n<style>\r\n    .container {\r\n        min-height: 100vh;\r\n        background: linear-gradient(180deg, #E8F5E8 0%, #D4EDD4 50%, #C8E6C8 100%);\r\n        display: flex;\r\n        flex-direction: column;\r\n        padding: 40rpx;\r\n        box-sizing: border-box;\r\n        position: relative;\r\n        overflow: hidden;\r\n    }\r\n    \r\n    /* 背景装饰 */\r\n    .container::before {\r\n        content: '';\r\n        position: absolute;\r\n        top: 0;\r\n        left: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n        background: radial-gradient(circle at 20% 80%, rgba(76, 175, 80, 0.1) 0%, transparent 50%),\r\n                    radial-gradient(circle at 80% 20%, rgba(129, 199, 132, 0.1) 0%, transparent 50%);\r\n        pointer-events: none;\r\n    }\r\n    \r\n    .header {\r\n        flex: 0 0 auto;\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: center;\r\n        justify-content: center;\r\n        margin-bottom: 60rpx;\r\n        position: relative;\r\n        z-index: 1;\r\n    }\r\n    \r\n    .title-container {\r\n        text-align: center;\r\n        margin-bottom: 30rpx;\r\n    }\r\n    \r\n    .main-title {\r\n        font-size: 56rpx;\r\n        font-weight: bold;\r\n        color: #2E7D32;\r\n        margin-bottom: 16rpx;\r\n        display: block;\r\n        text-shadow: 0 2rpx 4rpx rgba(0, 0, 0, 0.1);\r\n    }\r\n    \r\n    .sub-title {\r\n        font-size: 28rpx;\r\n        color: #4CAF50;\r\n        display: block;\r\n        font-weight: 500;\r\n    }\r\n    \r\n    /* 装饰叶子 */\r\n    .decoration {\r\n        position: relative;\r\n        width: 200rpx;\r\n        height: 100rpx;\r\n    }\r\n    \r\n    .leaf {\r\n        position: absolute;\r\n        width: 40rpx;\r\n        height: 60rpx;\r\n        background: #4CAF50;\r\n        border-radius: 50% 0 50% 0;\r\n        opacity: 0.3;\r\n        animation: leafFloat 3s ease-in-out infinite;\r\n    }\r\n    \r\n    .leaf-1 {\r\n        top: 0;\r\n        left: 30rpx;\r\n        animation-delay: 0s;\r\n    }\r\n    \r\n    .leaf-2 {\r\n        top: 20rpx;\r\n        left: 80rpx;\r\n        animation-delay: 1s;\r\n        transform: scale(0.8);\r\n    }\r\n    \r\n    .leaf-3 {\r\n        top: 40rpx;\r\n        right: 30rpx;\r\n        animation-delay: 2s;\r\n        transform: scale(0.6);\r\n    }\r\n    \r\n    @keyframes leafFloat {\r\n        0%, 100% { transform: translateY(0) rotate(0deg); }\r\n        50% { transform: translateY(-10rpx) rotate(5deg); }\r\n    }\r\n    \r\n    .button-container {\r\n        flex: 1;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        position: relative;\r\n        z-index: 1;\r\n    }\r\n    \r\n    .button-group {\r\n        display: flex;\r\n        flex-direction: column;\r\n        gap: 24rpx;\r\n        width: 100%;\r\n    }\r\n    \r\n    .action-button {\r\n        background: rgba(255, 255, 255, 0.95);\r\n        border-radius: 28rpx;\r\n        padding: 48rpx 40rpx;\r\n        display: flex;\r\n        align-items: center;\r\n        box-shadow: 0 6rpx 24rpx rgba(0, 0, 0, 0.1);\r\n        transition: all 0.3s ease;\r\n        border: 2rpx solid rgba(0, 0, 0, 0.05);\r\n        position: relative;\r\n        overflow: hidden;\r\n        margin-bottom: 32rpx;\r\n    }\r\n    \r\n    .action-button::before {\r\n        content: '';\r\n        position: absolute;\r\n        top: 0;\r\n        left: 0;\r\n        right: 0;\r\n        bottom: 0;\r\n        background: linear-gradient(135deg, rgba(0, 0, 0, 0.02) 0%, transparent 100%);\r\n        opacity: 0;\r\n        transition: opacity 0.3s ease;\r\n    }\r\n    \r\n    .action-button:active {\r\n        transform: translateY(2rpx);\r\n        box-shadow: 0 2rpx 12rpx rgba(0, 0, 0, 0.15);\r\n    }\r\n    \r\n    .action-button:active::before {\r\n        opacity: 1;\r\n    }\r\n    \r\n    .camera-button {\r\n        border-left: 6rpx solid #666;\r\n    }\r\n    \r\n    .gallery-button {\r\n        border-left: 6rpx solid #888;\r\n    }\r\n    \r\n    .button-icon {\r\n        width: 120rpx;\r\n        height: 120rpx;\r\n        background: #f5f5f5;\r\n        border-radius: 24rpx;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        margin-right: 40rpx;\r\n        flex-shrink: 0;\r\n        border: 2rpx solid #e0e0e0;\r\n    }\r\n    \r\n    .icon-image {\r\n        width: 60rpx;\r\n        height: 60rpx;\r\n    }\r\n    \r\n    .button-content {\r\n        flex: 1;\r\n        display: flex;\r\n        flex-direction: column;\r\n    }\r\n    \r\n    .button-text {\r\n        font-size: 40rpx;\r\n        font-weight: 600;\r\n        color: #333;\r\n        margin-bottom: 12rpx;\r\n    }\r\n    \r\n    .button-desc {\r\n        font-size: 28rpx;\r\n        color: #666;\r\n        line-height: 1.4;\r\n    }\r\n    \r\n    .button-arrow {\r\n        font-size: 44rpx;\r\n        color: #999;\r\n        font-weight: bold;\r\n        margin-left: 20rpx;\r\n        opacity: 0.7;\r\n    }\r\n    \r\n    .footer {\r\n        flex: 0 0 auto;\r\n        display: flex;\r\n        align-items: center;\r\n        justify-content: center;\r\n        margin-top: 40rpx;\r\n        position: relative;\r\n        z-index: 1;\r\n    }\r\n    \r\n    .footer-content {\r\n        text-align: center;\r\n        /* background: rgba(255, 255, 255, 0.8); */\r\n        padding: 24rpx 32rpx;\r\n        border-radius: 16rpx;\r\n        /* border: 1rpx solid rgba(76, 175, 80, 0.2); */\r\n    }\r\n    \r\n    .footer-text {\r\n        font-size: 26rpx;\r\n        color: #2E7D32;\r\n        display: block;\r\n        margin-bottom: 8rpx;\r\n        font-weight: 500;\r\n    }\r\n    \r\n    .footer-sub-text {\r\n        font-size: 22rpx;\r\n        color: #4CAF50;\r\n        display: block;\r\n        opacity: 0.8;\r\n    }\n    /* 结果弹窗样式 */\n    .result-popup {\n        position: fixed;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        z-index: 999;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n    \n    .popup-mask {\n        position: absolute;\r\n\t\tz-index: -1;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background-color: rgba(0, 0, 0, 0.5);\n    }\n    \n    .popup-content {\n        width: 90%;\n        max-height: 80vh;\n        background-color: #fff;\n        border-radius: 24rpx;\n        overflow: hidden;\n        display: flex;\n        flex-direction: column;\n        box-shadow: 0 10rpx 50rpx rgba(0, 0, 0, 0.2);\n    }\n    \n    .popup-header {\n        padding: 30rpx;\n        display: flex;\n        justify-content: space-between;\n        align-items: center;\n        border-bottom: 1rpx solid #f5f5f5;\n    }\n    \n    .popup-title {\n        font-size: 36rpx;\n        font-weight: bold;\n        color: #333;\n    }\n    \n    .close-btn {\n        font-size: 44rpx;\n        color: #999;\n        padding: 10rpx 20rpx;\n    }\n    \n    .result-summary {\n        padding: 20rpx 30rpx;\n        background-color: #f9f9f9;\n    }\n    \n    .summary-text {\n        font-size: 28rpx;\n        color: #666;\n    }\n    \n    .result-list {\n        flex: 1;\n        padding: 20rpx 0;\n    }\n    \n    .result-item {\n        display: flex;\n        align-items: center;\n        padding: 20rpx 30rpx;\n        border-bottom: 1rpx solid #f5f5f5;\n    }\n    \n    .result-image {\n        width: 120rpx;\n        height: 120rpx;\n        border-radius: 12rpx;\n        margin-right: 20rpx;\n    }\n    \n    .result-info {\n        flex: 1;\n        display: flex;\n        flex-direction: column;\n    }\n    \n    .pest-name {\n        font-size: 32rpx;\n        color: #333;\n        margin-bottom: 10rpx;\n    }\n    \n    .confidence {\n        font-size: 26rpx;\n        color: #666;\n    }\n    \n    .result-arrow {\n        font-size: 40rpx;\n        color: #999;\n        margin-left: 20rpx;\n    }\n    \n    .popup-footer {\n        padding: 20rpx 30rpx;\n        border-top: 1rpx solid #f5f5f5;\n    }\n    \n    .record-btn {\n        width: 100%;\n        height: 80rpx;\n        line-height: 80rpx;\n        background-color: #4CAF50;\n        color: white;\n        border-radius: 40rpx;\n        font-size: 30rpx;\n        border: none;\n    }\n    \n    .record-btn::after {\n        border: none;\n    }\r\n</style>","import MiniProgramPage from 'D:/Projects/frontend/pages/index/index.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","identifyImage","getApiUrl"],"mappings":"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"}