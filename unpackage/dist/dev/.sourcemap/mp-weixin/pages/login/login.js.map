{"version":3,"file":"login.js","sources":["pages/login/login.vue","../../HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\n  <view class=\"login-page\">\n    <button \n      v-if=\"!hasLogin\"\n      open-type=\"getUserInfo\" \n      @getuserinfo=\"handleGetUserInfo\"\n      class=\"login-btn\"\n    >\n      <image src=\"/static/logo.png\" mode=\"widthFix\" />\n      微信一键登录\n    </button>\n    <view v-else class=\"welcome\">\n      欢迎回来，{{userInfo.nickname}}\n    </view>\n  </view>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      hasLogin: false,\n      userInfo: {}\n    }\n  },\n  onLoad() {\n    this.checkLogin()\n  },\n  methods: {\n    // 检查登录状态\n    checkLogin() {\n      const token = uni.getStorageSync('token')\n      if (token) {\n        this.hasLogin = true\n        this.userInfo = uni.getStorageSync('userInfo') || {}\n      }\n    },\n    \n    // 获取用户信息\n    async handleGetUserInfo(e) {\n      const userInfo = e.detail.userInfo\n      if (!userInfo) {\n        uni.showToast({ title: '您拒绝了授权', icon: 'none' })\n        return\n      }\n\n      uni.showLoading({ title: '登录中...' })\n      \n      try {\n        // 获取code\n        const loginRes = await uni.login({\n          provider: 'weixin'\n        })\n        \n        // 发送到后端\n        const res = await uni.request({\n          url: 'http://localhost:5000/api/auth/login',\n          method: 'POST',\n          data: {\n            code: loginRes.code,\n            userInfo: userInfo\n          }\n        })\n        \n        if (res.data.code === 200) {\n          // 存储token和用户信息\n          uni.setStorageSync('token', res.data.data.token)\n          uni.setStorageSync('userInfo', res.data.data.userInfo)\n          \n          this.hasLogin = true\n          this.userInfo = res.data.data.userInfo\n          \n          uni.hideLoading()\n          uni.showToast({ title: '登录成功' })\n          \n          // 跳转到首页或返回上一页\n          setTimeout(() => {\n            uni.reLaunch({ url: '/pages/index/index' })\n          }, 1500)\n        } else {\n          uni.hideLoading()\n          uni.showToast({ title: res.data.message || '登录失败', icon: 'none' })\n        }\n      } catch (error) {\n        uni.hideLoading()\n        uni.showToast({ title: '网络错误，请重试', icon: 'none' })\n        console.error('登录错误:', error)\n      }\n    }\n  }\n}\n</script>\n\n<style>\n.login-page {\n  padding: 40rpx;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100vh;\n}\n\n.login-btn {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background-color: #07C160;\n  color: white;\n  border-radius: 50rpx;\n  padding: 20rpx 40rpx;\n}\n\n.login-btn image {\n  width: 40rpx;\n  margin-right: 15rpx;\n}\n\n.welcome {\n  font-size: 32rpx;\n  color: #333;\n}\n</style>","import MiniProgramPage from 'D:/Projects/frontend/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;;AAkBA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,UAAU;AAAA,MACV,UAAU,CAAC;AAAA,IACb;AAAA,EACD;AAAA,EACD,SAAS;AACP,SAAK,WAAW;AAAA,EACjB;AAAA,EACD,SAAS;AAAA;AAAA,IAEP,aAAa;AACX,YAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,UAAI,OAAO;AACT,aAAK,WAAW;AAChB,aAAK,WAAWA,cAAAA,MAAI,eAAe,UAAU,KAAK,CAAC;AAAA,MACrD;AAAA,IACD;AAAA;AAAA,IAGD,MAAM,kBAAkB,GAAG;AACzB,YAAM,WAAW,EAAE,OAAO;AAC1B,UAAI,CAAC,UAAU;AACbA,sBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,QAAQ;AAC/C;AAAA,MACF;AAEAA,oBAAAA,MAAI,YAAY,EAAE,OAAO,UAAU;AAEnC,UAAI;AAEF,cAAM,WAAW,MAAMA,cAAG,MAAC,MAAM;AAAA,UAC/B,UAAU;AAAA,SACX;AAGD,cAAM,MAAM,MAAMA,cAAG,MAAC,QAAQ;AAAA,UAC5B,KAAK;AAAA,UACL,QAAQ;AAAA,UACR,MAAM;AAAA,YACJ,MAAM,SAAS;AAAA,YACf;AAAA,UACF;AAAA,SACD;AAED,YAAI,IAAI,KAAK,SAAS,KAAK;AAEzBA,wBAAG,MAAC,eAAe,SAAS,IAAI,KAAK,KAAK,KAAK;AAC/CA,wBAAG,MAAC,eAAe,YAAY,IAAI,KAAK,KAAK,QAAQ;AAErD,eAAK,WAAW;AAChB,eAAK,WAAW,IAAI,KAAK,KAAK;AAE9BA,wBAAAA,MAAI,YAAY;AAChBA,wBAAAA,MAAI,UAAU,EAAE,OAAO,OAAK,CAAG;AAG/B,qBAAW,MAAM;AACfA,0BAAAA,MAAI,SAAS,EAAE,KAAK,sBAAsB;AAAA,UAC3C,GAAE,IAAI;AAAA,eACF;AACLA,wBAAAA,MAAI,YAAY;AAChBA,8BAAI,UAAU,EAAE,OAAO,IAAI,KAAK,WAAW,QAAQ,MAAM,QAAQ;AAAA,QACnE;AAAA,MACA,SAAO,OAAO;AACdA,sBAAAA,MAAI,YAAY;AAChBA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AACjDA,sBAAAA,MAAc,MAAA,SAAA,+BAAA,SAAS,KAAK;AAAA,MAC9B;AAAA,IACF;AAAA,EACF;AACF;;;;;;;;;;;;ACzFA,GAAG,WAAW,eAAe;"}