<<<<<<< HEAD
{"version":3,"file":"login.js","sources":["pages/login/login.vue","../../HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\r\n  <view class=\"login-page\">\r\n    <button \r\n      v-if=\"!hasLogin\"\r\n      open-type=\"getUserInfo\" \r\n      @getuserinfo=\"handleGetUserInfo\"\r\n      class=\"login-btn\"\r\n    >\r\n      <image src=\"/static/logo.png\" mode=\"widthFix\" />\r\n      微信一键登录\r\n    </button>\r\n    <view v-else class=\"welcome\">\r\n      欢迎回来，{{userInfo.nickname}}\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  data() {\r\n    return {\r\n      hasLogin: false,\r\n      userInfo: {}\r\n    }\r\n  },\r\n  onLoad() {\r\n    this.checkLogin()\r\n  },\r\n  methods: {\r\n    // 检查登录状态\r\n    checkLogin() {\r\n      const token = uni.getStorageSync('token')\r\n      if (token) {\r\n        this.hasLogin = true\r\n        this.userInfo = uni.getStorageSync('userInfo') || {}\r\n      }\r\n    },\r\n    \r\n    // 获取用户信息\r\n    async handleGetUserInfo(e) {\r\n      const userInfo = e.detail.userInfo\r\n      if (!userInfo) {\r\n        uni.showToast({ title: '您拒绝了授权', icon: 'none' })\r\n        return\r\n      }\r\n\r\n      uni.showLoading({ title: '登录中...' })\r\n      \r\n      try {\r\n        // 获取code\r\n        const loginRes = await uni.login({\r\n          provider: 'weixin'\r\n        })\r\n        \r\n        // 发送到后端\r\n        const res = await uni.request({\r\n          url: 'http://localhost:5000/api/auth/login',\r\n          method: 'POST',\r\n          data: {\r\n            code: loginRes.code,\r\n            userInfo: userInfo\r\n          }\r\n        })\r\n        \r\n        if (res.data.code === 200) {\r\n          // 存储token和用户信息\r\n          uni.setStorageSync('token', res.data.data.token)\r\n          uni.setStorageSync('userInfo', res.data.data.userInfo)\r\n          \r\n          this.hasLogin = true\r\n          this.userInfo = res.data.data.userInfo\r\n          \r\n          uni.hideLoading()\r\n          uni.showToast({ title: '登录成功' })\r\n          \r\n          // 跳转到首页或返回上一页\r\n          setTimeout(() => {\r\n            uni.reLaunch({ url: '/pages/index/index' })\r\n          }, 1500)\r\n        } else {\r\n          uni.hideLoading()\r\n          uni.showToast({ title: res.data.message || '登录失败', icon: 'none' })\r\n        }\r\n      } catch (error) {\r\n        uni.hideLoading()\r\n        uni.showToast({ title: '网络错误，请重试', icon: 'none' })\r\n        console.error('登录错误:', error)\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.login-page {\r\n  padding: 40rpx;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  height: 100vh;\r\n}\r\n\r\n.login-btn {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  background-color: #07C160;\r\n  color: white;\r\n  border-radius: 50rpx;\r\n  padding: 20rpx 40rpx;\r\n}\r\n\r\n.login-btn image {\r\n  width: 40rpx;\r\n  margin-right: 15rpx;\r\n}\r\n\r\n.welcome {\r\n  font-size: 32rpx;\r\n  color: #333;\r\n}\r\n</style>","import MiniProgramPage from 'D:/Projects/frontend/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni"],"mappings":";;;AAkBA,MAAK,YAAU;AAAA,EACb,OAAO;AACL,WAAO;AAAA,MACL,UAAU;AAAA,MACV,UAAU,CAAC;AAAA,IACb;AAAA,EACD;AAAA,EACD,SAAS;AACP,SAAK,WAAW;AAAA,EACjB;AAAA,EACD,SAAS;AAAA;AAAA,IAEP,aAAa;AACX,YAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,UAAI,OAAO;AACT,aAAK,WAAW;AAChB,aAAK,WAAWA,cAAAA,MAAI,eAAe,UAAU,KAAK,CAAC;AAAA,MACrD;AAAA,IACD;AAAA;AAAA,IAGD,MAAM,kBAAkB,GAAG;AACzB,YAAM,WAAW,EAAE,OAAO;AAC1B,UAAI,CAAC,UAAU;AACbA,sBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,QAAQ;AAC/C;AAAA,MACF;AAEAA,oBAAAA,MAAI,YAAY,EAAE,OAAO,UAAU;AAEnC,UAAI;AAEF,cAAM,WAAW,MAAMA,cAAG,MAAC,MAAM;AAAA,UAC/B,UAAU;AAAA,SACX;AAGD,cAAM,MAAM,MAAMA,cAAG,MAAC,QAAQ;AAAA,UAC5B,KAAK;AAAA,UACL,QAAQ;AAAA,UACR,MAAM;AAAA,YACJ,MAAM,SAAS;AAAA,YACf;AAAA,UACF;AAAA,SACD;AAED,YAAI,IAAI,KAAK,SAAS,KAAK;AAEzBA,wBAAG,MAAC,eAAe,SAAS,IAAI,KAAK,KAAK,KAAK;AAC/CA,wBAAG,MAAC,eAAe,YAAY,IAAI,KAAK,KAAK,QAAQ;AAErD,eAAK,WAAW;AAChB,eAAK,WAAW,IAAI,KAAK,KAAK;AAE9BA,wBAAAA,MAAI,YAAY;AAChBA,wBAAAA,MAAI,UAAU,EAAE,OAAO,OAAK,CAAG;AAG/B,qBAAW,MAAM;AACfA,0BAAAA,MAAI,SAAS,EAAE,KAAK,sBAAsB;AAAA,UAC3C,GAAE,IAAI;AAAA,eACF;AACLA,wBAAAA,MAAI,YAAY;AAChBA,8BAAI,UAAU,EAAE,OAAO,IAAI,KAAK,WAAW,QAAQ,MAAM,QAAQ;AAAA,QACnE;AAAA,MACA,SAAO,OAAO;AACdA,sBAAAA,MAAI,YAAY;AAChBA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AACjDA,sBAAAA,MAAc,MAAA,SAAA,+BAAA,SAAS,KAAK;AAAA,MAC9B;AAAA,IACF;AAAA,EACF;AACF;;;;;;;;;;;;ACzFA,GAAG,WAAW,eAAe;"}
=======
{"version":3,"file":"login.js","sources":["../../HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["import MiniProgramPage from 'C:/AI/FPDIS/frontend/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["MiniProgramPage"],"mappings":";;AACA,GAAG,WAAWA,MAAe,eAAA;"}
>>>>>>> cdn
