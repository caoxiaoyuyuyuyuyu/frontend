{"version":3,"file":"app.js","sources":["App.vue","main.js"],"sourcesContent":["<script>\r\nexport default {\r\n  onLaunch: function() {\r\n    console.log('App Launch')\r\n    this.setupInterceptor()\r\n    this.checkLogin()\r\n  },\r\n  methods: {\r\n    checkLogin() {\r\n      const token = uni.getStorageSync('token')\r\n      if (!token) {\r\n        uni.reLaunch({ url: '/pages/login/login' })\r\n        return false\r\n      }\r\n\r\n      // 可选：验证token有效性\r\n      uni.request({\r\n        url: 'http://localhost:5000/api/auth/check_login',\r\n        method: 'GET',\r\n        header: { 'Authorization': `Bearer ${token}` },\r\n        success: (res) => {\r\n          if (res.data.code === 401) {\r\n            this.handleLogout()\r\n          }\r\n        },\r\n        fail: () => {\r\n          console.log('验证登录状态失败')\r\n        }\r\n      })\r\n      \r\n      return true\r\n    },\r\n    \r\n    handleLogout() {\r\n      uni.removeStorageSync('token')\r\n      uni.removeStorageSync('userInfo')\r\n      uni.reLaunch({ url: '/pages/login/login' })\r\n    },\r\n    \r\n    setupInterceptor() {\r\n      // 请求拦截器 - 添加token\r\n      uni.addInterceptor('request', {\r\n        invoke(args) {\r\n          const token = uni.getStorageSync('token')\r\n          if (token) {\r\n            if (!args.header) args.header = {}\r\n            args.header['Authorization'] = `Bearer ${token}`\r\n          }\r\n          return args\r\n        },\r\n        fail(err) {\r\n          console.error('请求失败:', err)\r\n        }\r\n      })\r\n      \r\n      // 响应拦截器 - 处理401错误\r\n      uni.addInterceptor('request', {\r\n        success(args) {\r\n          if (args.data && args.data.code === 401) {\r\n            this.handleLogout()\r\n          }\r\n          return args\r\n        }\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n<style>\r\n\t/*每个页面公共css */\r\n</style>\r\n","import App from './App'\n\n// #ifndef VUE3\nimport Vue from 'vue'\nimport './uni.promisify.adaptor'\nVue.config.productionTip = false\nApp.mpType = 'app'\nconst app = new Vue({\n  ...App\n})\napp.$mount()\n// #endif\n\n// #ifdef VUE3\nimport { createSSRApp } from 'vue'\nexport function createApp() {\n  const app = createSSRApp(App)\n  return {\n    app\n  }\n}\n// #endif"],"names":["uni","createSSRApp","App"],"mappings":";;;;;;;;;;;;;;;AACA,MAAK,YAAU;AAAA,EACb,UAAU,WAAW;AACnBA,kBAAAA,MAAY,MAAA,OAAA,gBAAA,YAAY;AACxB,SAAK,iBAAiB;AACtB,SAAK,WAAW;AAAA,EACjB;AAAA,EACD,SAAS;AAAA,IACP,aAAa;AACX,YAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,UAAI,CAAC,OAAO;AACVA,sBAAAA,MAAI,SAAS,EAAE,KAAK,sBAAsB;AAC1C,eAAO;AAAA,MACT;AAGAA,oBAAAA,MAAI,QAAQ;AAAA,QACV,KAAK;AAAA,QACL,QAAQ;AAAA,QACR,QAAQ,EAAE,iBAAiB,UAAU,KAAK,GAAI;AAAA,QAC9C,SAAS,CAAC,QAAQ;AAChB,cAAI,IAAI,KAAK,SAAS,KAAK;AACzB,iBAAK,aAAa;AAAA,UACpB;AAAA,QACD;AAAA,QACD,MAAM,MAAM;AACVA,wBAAAA,MAAA,MAAA,OAAA,iBAAY,UAAU;AAAA,QACxB;AAAA,OACD;AAED,aAAO;AAAA,IACR;AAAA,IAED,eAAe;AACbA,oBAAG,MAAC,kBAAkB,OAAO;AAC7BA,oBAAG,MAAC,kBAAkB,UAAU;AAChCA,oBAAAA,MAAI,SAAS,EAAE,KAAK,sBAAsB;AAAA,IAC3C;AAAA,IAED,mBAAmB;AAEjBA,oBAAG,MAAC,eAAe,WAAW;AAAA,QAC5B,OAAO,MAAM;AACX,gBAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,cAAI,OAAO;AACT,gBAAI,CAAC,KAAK;AAAQ,mBAAK,SAAS,CAAC;AACjC,iBAAK,OAAO,eAAe,IAAI,UAAU,KAAK;AAAA,UAChD;AACA,iBAAO;AAAA,QACR;AAAA,QACD,KAAK,KAAK;AACRA,wBAAAA,MAAc,MAAA,SAAA,iBAAA,SAAS,GAAG;AAAA,QAC5B;AAAA,OACD;AAGDA,oBAAG,MAAC,eAAe,WAAW;AAAA,QAC5B,QAAQ,MAAM;AACZ,cAAI,KAAK,QAAQ,KAAK,KAAK,SAAS,KAAK;AACvC,iBAAK,aAAa;AAAA,UACpB;AACA,iBAAO;AAAA,QACT;AAAA,OACD;AAAA,IACH;AAAA,EACF;AACF;ACnDO,SAAS,YAAY;AAC1B,QAAM,MAAMC,cAAY,aAACC,SAAG;AAC5B,SAAO;AAAA,IACL;AAAA,EACD;AACH;;;"}