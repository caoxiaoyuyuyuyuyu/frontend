{"version":3,"file":"login.js","sources":["components/login/login.vue","../../HBuilderX.4.64.2025042916/HBuilderX/plugins/uniapp-cli-vite/uniComponent:/RDovUHJvamVjdHMvZnJvbnRlbmQvY29tcG9uZW50cy9sb2dpbi9sb2dpbi52dWU"],"sourcesContent":["<template>\r\n  <view v-if=\"show\" class=\"login-popup-mask\">\r\n    <view class=\"login-popup-box\">\r\n      <image src=\"/static/logo.png\" mode=\"widthFix\" class=\"login-popup-logo\" />\r\n      <view class=\"login-popup-title\">请先登录</view>\r\n      <button \r\n        open-type=\"getUserInfo\" \r\n        @getuserinfo=\"handleGetUserInfo\"\r\n        class=\"login-popup-btn\"\r\n      >\r\n        微信一键登录\r\n      </button>\r\n    </view>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n  name: 'LoginPopup',\r\n  props: {\r\n    show: {\r\n      type: Boolean,\r\n      default: false\r\n    }\r\n  },\r\n  data() {\r\n    return {\r\n      hasLogin: false,\r\n      userInfo: {}\r\n    }\r\n  },\r\n  watch: {\r\n    show(val) {\r\n      if (val) {\r\n        this.checkLogin();\r\n      }\r\n    }\r\n  },\r\n  methods: {\r\n    // 检查登录状态\r\n    checkLogin() {\r\n      const token = uni.getStorageSync('token')\r\n      if (token) {\r\n        this.hasLogin = true\r\n        this.userInfo = uni.getStorageSync('userInfo') || {}\r\n        // 已登录直接通知父组件\r\n        this.$emit('success', this.userInfo)\r\n      }\r\n    },\r\n    // 获取用户信息\r\n    async handleGetUserInfo(e) {\r\n      const userInfo = e.detail.userInfo\r\n      if (!userInfo) {\r\n        uni.showToast({ title: '您拒绝了授权', icon: 'none' })\r\n        return\r\n      }\r\n      uni.showLoading({ title: '登录中...' })\r\n      try {\r\n        // 获取code\r\n        const loginRes = await uni.login({\r\n          provider: 'weixin'\r\n        })\r\n        // 发送到后端\r\n        const res = await uni.request({\r\n          url: 'http://121.41.69.216:5000/api/auth/login',\r\n          // url: 'http://192.168.142.56:5000/api/auth/login',\r\n          method: 'POST',\r\n          data: {\r\n            code: loginRes.code,\r\n            userInfo: userInfo\r\n          }\r\n        })\r\n        if (res.data.code === 200) {\r\n          // 存储token和用户信息\r\n          uni.setStorageSync('token', res.data.data.token)\r\n          uni.setStorageSync('userInfo', res.data.data.userInfo)\r\n          this.hasLogin = true\r\n          this.userInfo = res.data.data.userInfo\r\n          uni.hideLoading()\r\n          uni.showToast({ title: '登录成功' })\r\n          // 通知父组件登录成功\r\n          this.$emit('success', this.userInfo)\r\n        } else {\r\n          uni.hideLoading()\r\n          uni.showToast({ title: res.data.message || '登录失败', icon: 'none' })\r\n        }\r\n      } catch (error) {\r\n        uni.hideLoading()\r\n        uni.showToast({ title: '网络错误，请重试', icon: 'none' })\r\n        console.error('登录错误:', error)\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style>\r\n.login-popup-mask {\r\n  position: fixed;\r\n  left: 0; top: 0; right: 0; bottom: 0;\r\n  background: rgba(0,0,0,0.4);\r\n  z-index: 9999;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n}\r\n.login-popup-box {\r\n  background: #fff;\r\n  border-radius: 24rpx;\r\n  padding: 60rpx 40rpx 40rpx 40rpx;\r\n  display: flex;\r\n  flex-direction: column;\r\n  align-items: center;\r\n  box-shadow: 0 8rpx 32rpx rgba(0,0,0,0.15);\r\n  min-width: 500rpx;\r\n}\r\n.login-popup-logo {\r\n  width: 100rpx;\r\n  margin-bottom: 30rpx;\r\n}\r\n.login-popup-title {\r\n  font-size: 32rpx;\r\n  color: #333;\r\n  margin-bottom: 40rpx;\r\n  font-weight: bold;\r\n}\r\n.login-popup-btn {\r\n  background-color: #07C160;\r\n  color: white;\r\n  border-radius: 50rpx;\r\n  padding: 20rpx 40rpx;\r\n  font-size: 32rpx;\r\n}\r\n</style>","import Component from 'D:/Projects/frontend/components/login/login.vue'\nwx.createComponent(Component)"],"names":["uni"],"mappings":";;;AAiBA,MAAK,YAAU;AAAA,EACb,MAAM;AAAA,EACN,OAAO;AAAA,IACL,MAAM;AAAA,MACJ,MAAM;AAAA,MACN,SAAS;AAAA,IACX;AAAA,EACD;AAAA,EACD,OAAO;AACL,WAAO;AAAA,MACL,UAAU;AAAA,MACV,UAAU,CAAC;AAAA,IACb;AAAA,EACD;AAAA,EACD,OAAO;AAAA,IACL,KAAK,KAAK;AACR,UAAI,KAAK;AACP,aAAK,WAAU;AAAA,MACjB;AAAA,IACF;AAAA,EACD;AAAA,EACD,SAAS;AAAA;AAAA,IAEP,aAAa;AACX,YAAM,QAAQA,cAAAA,MAAI,eAAe,OAAO;AACxC,UAAI,OAAO;AACT,aAAK,WAAW;AAChB,aAAK,WAAWA,cAAAA,MAAI,eAAe,UAAU,KAAK,CAAC;AAEnD,aAAK,MAAM,WAAW,KAAK,QAAQ;AAAA,MACrC;AAAA,IACD;AAAA;AAAA,IAED,MAAM,kBAAkB,GAAG;AACzB,YAAM,WAAW,EAAE,OAAO;AAC1B,UAAI,CAAC,UAAU;AACbA,sBAAG,MAAC,UAAU,EAAE,OAAO,UAAU,MAAM,QAAQ;AAC/C;AAAA,MACF;AACAA,oBAAAA,MAAI,YAAY,EAAE,OAAO,UAAU;AACnC,UAAI;AAEF,cAAM,WAAW,MAAMA,cAAG,MAAC,MAAM;AAAA,UAC/B,UAAU;AAAA,SACX;AAED,cAAM,MAAM,MAAMA,cAAG,MAAC,QAAQ;AAAA,UAC5B,KAAK;AAAA;AAAA,UAEL,QAAQ;AAAA,UACR,MAAM;AAAA,YACJ,MAAM,SAAS;AAAA,YACf;AAAA,UACF;AAAA,SACD;AACD,YAAI,IAAI,KAAK,SAAS,KAAK;AAEzBA,wBAAG,MAAC,eAAe,SAAS,IAAI,KAAK,KAAK,KAAK;AAC/CA,wBAAG,MAAC,eAAe,YAAY,IAAI,KAAK,KAAK,QAAQ;AACrD,eAAK,WAAW;AAChB,eAAK,WAAW,IAAI,KAAK,KAAK;AAC9BA,wBAAAA,MAAI,YAAY;AAChBA,wBAAAA,MAAI,UAAU,EAAE,OAAO,OAAK,CAAG;AAE/B,eAAK,MAAM,WAAW,KAAK,QAAQ;AAAA,eAC9B;AACLA,wBAAAA,MAAI,YAAY;AAChBA,8BAAI,UAAU,EAAE,OAAO,IAAI,KAAK,WAAW,QAAQ,MAAM,QAAQ;AAAA,QACnE;AAAA,MACA,SAAO,OAAO;AACdA,sBAAAA,MAAI,YAAY;AAChBA,sBAAG,MAAC,UAAU,EAAE,OAAO,YAAY,MAAM,QAAQ;AACjDA,sBAAAA,MAAc,MAAA,SAAA,oCAAA,SAAS,KAAK;AAAA,MAC9B;AAAA,IACF;AAAA,EACF;AACF;;;;;;;;;;AC5FA,GAAG,gBAAgB,SAAS;"}